# 🏀 JBA選手データ照合システム（リアルタイム版）

## 📋 概要
**リアルタイムでJBAサイトからデータを取得**し、エクセルファイルと照合するシステムです。

**どんな些細な違いでも拾える！JBAデータが常に正解**

## 🌐 アクセス方法
デプロイ後、以下のURLでアクセスできます：
```
https://jba-verification-system-realtime-xxxxx.streamlit.app
```

## 📊 主な機能

### 🔄 **リアルタイムデータ取得**
- **JBAサイトに直接アクセス**: 最新のデータを取得
- **自動ログイン**: ユーザーがログイン情報を入力
- **大学別検索**: 指定した大学のチームのみを検索
- **高速処理**: 特定大学のみなので処理時間短縮

### 🔍 **究極の検出能力**
- **漢字の微妙な違い**: 崎 vs 﨑、渡辺 vs 渡邉
- **名前の表記揺れ**: ムバヤ ムカンクステファン vs ムバヤ・ムカンクステファン
- **記号・スペースの違い**: 全角・半角統一、中点、カンマ、ピリオドの正規化
- **音声類似度**: ひらがな vs カタカナ対応
- **部分文字列マッチング**: 名前の一部が一致する場合も検出

### 📄 **複数エクセル処理**
- **複数ファイルアップロード**: ドラッグ&ドロップ対応
- **一括処理**: 複数のエクセルファイルを同時処理
- **ZIPダウンロード**: 修正版ファイルをまとめてダウンロード

### 📊 **結果表示**
- **リアルタイム表示**: 即座に照合結果を確認
- **タブ分け表示**: マッチ、未マッチ、複数候補を分けて表示
- **統計情報**: マッチ率、件数などの統計を表示
- **詳細分析**: 名前の違いを詳細に分析

## 📄 使用方法

### **1. JBAログイン情報を入力**
- **メールアドレス**: JBAアカウントのメールアドレス
- **パスワード**: JBAアカウントのパスワード

### **2. エクセルファイルを準備**
以下の列を含むエクセルファイルを準備してください：
- **選手名**: 選手名、名前、氏名、姓、名
- **生年月日**: 生年月日、誕生日
- **チーム名**: チーム名、所属、学校名、大学名

### **3. 複数ファイルをアップロード**
- ドラッグ&ドロップで複数のエクセルファイルをアップロード
- 対応形式: `.xlsx`, `.xls`

### **4. 大学名を指定**
- 処理したい大学名を入力
- 複数の大学を改行区切りで指定可能
- 例:
  ```
  白鴎大学
  早稲田大学
  慶應大学
  ```

### **5. 設定調整**
- **類似度閾値**: 1.00（推奨）- 完全一致を求める場合に使用
- 0.1-0.9の範囲で調整可能

### **6. 照合実行**
- 「リアルタイムデータ照合を実行」ボタンをクリック
- リアルタイムで結果を表示

### **7. 結果確認・ダウンロード**
- **✅ マッチ**: JBAデータと一致した選手
- **❌ 未マッチ**: JBAに登録されていない選手
- **⚠️ 複数マッチ**: 複数の候補がある選手
- **📄 修正版ダウンロード**: 修正版エクセルをZIPでダウンロード

## 📋 修正版エクセルの内容

### **追加される列**
- **照合結果**: ✅一致 / ❌未マッチ / ⚠️複数候補
- **JBA正解名**: JBAに登録されている正しい名前
- **JBA正解生年月日**: JBAに登録されている正しい生年月日
- **JBA正解チーム名**: JBAに登録されている正しいチーム名
- **類似度**: 名前の類似度（0.0-1.0）
- **修正提案**: 具体的な修正内容
- **詳細分析**: 名前の違いの詳細説明
- **些細な違い**: どんな些細な違いでも表示

### **修正提案の例**
- `名前: 佐伯 崚介` - 名前の表記を修正
- `生年月日: 2003年5月4日` - 生年月日を修正
- `チーム名: 白鴎大学` - チーム名を修正
- `修正不要` - 既に正しい
- `JBAに登録されていません` - 未登録選手

## 💡 活用例

### **例1: 名前の表記揺れ**
```
エクセル: 渡辺 太郎
JBA正解: 渡邉 太郎
修正提案: 名前: 渡邉 太郎
```

### **例2: 生年月日の形式違い**
```
エクセル: 2003/5/4
JBA正解: 2003年5月4日
修正提案: 生年月日: 2003年5月4日
```

### **例3: チーム名の略称**
```
エクセル: 白鴎大
JBA正解: 白鴎大学
修正提案: チーム名: 白鴎大学
```

## 🔧 技術仕様

### **リアルタイム取得**
- **Playwright**: ブラウザ自動化
- **非同期処理**: asyncioを使用した高速処理
- **セッション管理**: ログイン状態の維持
- **エラーハンドリング**: ネットワークエラーの適切な処理

### **検出アルゴリズム**
- **基本的な類似度**: SequenceMatcher
- **文字単位比較**: 共通文字数のカウント
- **部分文字列マッチング**: 部分一致の検出
- **音声類似度**: ひらがな・カタカナ対応
- **重み付き平均**: 複数のアルゴリズムを組み合わせ

### **正規化処理**
- **全角・半角統一**: unicodedata.normalize
- **記号・スペース正規化**: 中点、カンマ、ピリオド、スペース除去
- **長音符除去**: ー、−、‐、—、–の除去
- **大文字小文字統一**: 小文字に統一

### **日付正規化**
- **様々な形式対応**: YYYY/MM/DD、YYYY-MM-DD、YYYY年MM月DD日
- **ゼロパディング**: 月日を2桁に統一

## 🚀 デプロイ情報

### **プラットフォーム**
- **Streamlit Cloud**: 無料でデプロイ可能
- **自動更新**: GitHubのmainブランチにプッシュすると自動更新

### **必要なファイル**
- `realtime_web_verification_app.py`: メインアプリケーション
- `requirements.txt`: 必要なライブラリ
- `README_realtime.md`: このファイル

### **ライブラリ**
- `streamlit>=1.28.0`: Webアプリケーションフレームワーク
- `pandas>=1.5.0`: データ処理
- `openpyxl>=3.0.0`: エクセルファイル処理
- `playwright>=1.30.0`: ブラウザ自動化

## 📞 サポート

### **よくある質問**
- **Q: ログインに失敗する**
  - A: JBAアカウントのメールアドレスとパスワードを確認してください

- **Q: エクセルファイルがアップロードできない**
  - A: ファイル形式を確認（.xlsx, .xls）、ファイルサイズを確認（100MB以下推奨）

- **Q: 列名が認識されない**
  - A: 列名を「選手名」「生年月日」「チーム名」に変更、または対応する別名を使用

- **Q: マッチ率が低い**
  - A: 類似度閾値を下げる（1.00 → 0.8）、データの形式を確認

### **トラブルシューティング**
- **ファイルサイズ制限**: 100MB以下推奨
- **対応形式**: .xlsx, .xls
- **ブラウザ**: Chrome、Firefox、Safari、Edge対応
- **ネットワーク**: 安定したインターネット接続が必要

## 🎉 特徴

### **✅ リアルタイム対応**
- **最新データ**: JBAサイトからリアルタイム取得
- **高速処理**: 特定大学のみの検索で処理時間短縮
- **自動更新**: 常に最新のJBAデータを使用

### **✅ ユーザーフレンドリー**
- **コードが全くわからない人でも使える**
- インストール不要
- 設定不要
- ブラウザがあれば誰でも使用可能

### **🔍 高精度検出**
- **どんな些細な違いでも拾える**
- 漢字の違い、表記揺れ、記号の違い
- 音声類似度、部分文字列マッチング

### **📊 詳細分析**
- **JBAデータが常に正解**
- 修正版エクセルの自動生成
- 詳細な分析結果の提供

### **🌐 全員対応**
- **全員が同時に使用可能**
- リアルタイムで結果確認
- メンテナンス不要

---

**URLを共有するだけで、全員が使えるリアルタイムJBA選手データ照合システム！** 🏀
